<!-- templates/index.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Home - NyumbaFasta{% endblock %}

{% block extra_css %}
<style>
    :root {
        --blue-gradient: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
        --yellow-gradient: linear-gradient(135deg, #ffd60a 0%, #ffc300 100%);
        --blue-yellow-gradient: linear-gradient(135deg, #4361ee 0%, #ffd60a 100%);
        --dark-blue-gradient: linear-gradient(135deg, #2c3e50 0%, #4361ee 100%);
    }
    
    /* Hero Section */
    .hero-section {
        background: linear-gradient(rgba(0, 0, 0, 0.9), rgba(67, 97, 238, 0.2)), 
                    url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        padding: 180px 0 120px;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .hero-section::before {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 150px;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
        background-size: cover;
        background-repeat: no-repeat;
    }
    
    .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        background: var(--yellow-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1.5rem;
        line-height: 1.2;
        text-shadow: 0 2px 20px rgba(255, 214, 10, 0.3);
    }
    
    .hero-subtitle {
        font-size: 1.25rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 2.5rem;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }
    
    /* Search Card */
    .search-card {
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        border-radius: 25px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        padding: 2.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        position: relative;
        z-index: 1;
    }
    
    .search-card::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--blue-yellow-gradient);
        border-radius: 27px;
        z-index: -1;
        opacity: 0.1;
    }
    
    /* Region Select */
    .region-select-container {
        position: relative;
    }
    
    .region-select-container .input-group-text {
        background: var(--blue-gradient);
        color: white;
        border: none;
        border-radius: 12px 0 0 12px;
    }
    
    .region-select-container .form-control {
        border: 2px solid #e9ecef;
        border-left: none;
        border-radius: 0 12px 12px 0;
        transition: all 0.3s ease;
        height: 56px;
        padding-left: 0;
    }
    
    .region-select-container .form-control:focus {
        border-color: #ffd60a;
        box-shadow: 0 0 0 3px rgba(255, 214, 10, 0.2);
        outline: none;
    }
    
    /* Modern Region Dropdown */
    .region-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        border: 2px solid #4361ee;
        z-index: 1000;
        max-height: 400px;
        overflow-y: auto;
        display: none;
        margin-top: 5px;
    }
    
    .region-dropdown.show {
        display: block;
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .region-group {
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .region-group:last-child {
        border-bottom: none;
    }
    
    .region-header {
        padding: 12px 20px;
        background: #f8f9fa;
        color: #4361ee;
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        border-left: 3px solid #ffd60a;
    }
    
    .region-option {
        padding: 12px 20px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .region-option:hover {
        background: rgba(67, 97, 238, 0.1);
        padding-left: 25px;
    }
    
    .region-option.selected {
        background: var(--blue-gradient);
        color: white;
    }
    
    .region-option .flag {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: linear-gradient(45deg, #4361ee, #ffd60a);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: white;
        font-weight: bold;
    }
    
    /* Cards */
    .category-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: none;
        overflow: hidden;
        border-radius: 20px;
        background: white;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        height: 100%;
    }
    
    .category-card:hover {
        transform: translateY(-15px) scale(1.02);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }
    
    .property-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        overflow: hidden;
        border-radius: 20px;
        background: white;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        height: 100%;
    }
    
    .property-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        border-color: #4361ee;
    }
    
    .property-badge {
        position: absolute;
        top: 20px;
        left: 20px;
        background: var(--blue-gradient);
        color: white;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        z-index: 2;
    }
    
    /* Stats */
    .stat-card {
        background: var(--dark-blue-gradient);
        color: white;
        border-radius: 20px;
        padding: 2.5rem 1.5rem;
        height: 100%;
        transition: transform 0.3s ease;
        position: relative;
        overflow: hidden;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    .stat-card:nth-child(2) {
        background: var(--blue-gradient);
    }
    
    .stat-card:nth-child(3) {
        background: var(--yellow-gradient);
        color: #4361ee;
    }
    
    .stat-card:nth-child(4) {
        background: var(--blue-yellow-gradient);
        color: white;
    }
    
    .stat-card:hover {
        transform: translateY(-10px);
    }
    
    /* Features */
    .feature-icon {
        width: 90px;
        height: 90px;
        background: var(--blue-gradient);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        box-shadow: 0 15px 30px rgba(67, 97, 238, 0.3);
        transition: all 0.3s ease;
    }
    
    .category-card:hover .feature-icon {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 20px 40px rgba(67, 97, 238, 0.4);
        background: var(--yellow-gradient);
    }
    
    /* Location Cards */
    .location-card {
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
        height: 250px;
        color: white;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }
    
    .location-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .location-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    }
    
    .location-card:hover img {
        transform: scale(1.15);
    }
    
    .location-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        padding: 30px 25px 25px;
    }
    
    .location-overlay h6 {
        font-size: 1.25rem;
        margin-bottom: 5px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    /* CTA Section */
    .cta-section {
        background: var(--dark-blue-gradient);
        color: white;
        padding: 100px 0;
        position: relative;
        overflow: hidden;
    }
    
    .section-title {
        position: relative;
        display: inline-block;
        margin-bottom: 1.5rem;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: var(--blue-gradient);
        border-radius: 2px;
    }
    
    /* Custom Scrollbar */
    .region-dropdown::-webkit-scrollbar {
        width: 8px;
    }
    
    .region-dropdown::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .region-dropdown::-webkit-scrollbar-thumb {
        background: #4361ee;
        border-radius: 4px;
    }
    
    .region-dropdown::-webkit-scrollbar-thumb:hover {
        background: #3a56d4;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .hero-section {
            padding: 120px 0 80px;
            background-attachment: scroll;
        }
        
        .hero-title {
            font-size: 2.5rem;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
        }
        
        .search-card {
            padding: 1.5rem;
            margin: 0 10px;
        }
        
        .stat-card {
            padding: 1.5rem 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container position-relative">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <h1 class="hero-title mb-4">Find Your Dream Home Today!</h1>
                <p class="hero-subtitle mb-5">We collect the best properties from Facebook and various sources. Affordable prices, great locations, and secure housing solutions.</p>
                
                <!-- Advanced Search -->
                <div class="search-card">
                    <form action="{% url 'makazi:listings' %}" method="get" class="row g-3">
                        <!-- Region Select -->
                        <div class="col-lg-4">
                            <div class="region-select-container">
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">
                                        <i class="bi bi-geo-alt fs-5"></i>
                                    </span>
                                    <input type="text" 
                                           class="form-control" 
                                           name="location" 
                                           placeholder="Choose region..."
                                           id="regionInput"
                                           autocomplete="off"
                                           style="background: #f8f9fa;">
                                </div>
                                
                                <!-- Region Dropdown -->
                                <div style="color: black;" class="region-dropdown" id="regionDropdown">
                                    <!-- Mainland Regions -->
                                    <div class="region-group">
                                        <div class="region-header">Mainland Regions</div>
                                        <div class="region-option" data-value="Dar es Salaam">
                                            <span class="flag">DSM</span>
                                            Dar es Salaam
                                        </div>
                                        <div class="region-option" data-value="Arusha">
                                            <span class="flag">AR</span>
                                            Arusha
                                        </div>
                                        <div class="region-option" data-value="Mwanza">
                                            <span class="flag">MW</span>
                                            Mwanza
                                        </div>
                                        <div class="region-option" data-value="Mbeya">
                                            <span class="flag">MB</span>
                                            Mbeya
                                        </div>
                                        <div class="region-option" data-value="Dodoma">
                                            <span class="flag">DD</span>
                                            Dodoma
                                        </div>
                                        <div class="region-option" data-value="Tanga">
                                            <span class="flag">TN</span>
                                            Tanga
                                        </div>
                                        <div class="region-option" data-value="Morogoro">
                                            <span class="flag">MO</span>
                                            Morogoro
                                        </div>
                                        <div class="region-option" data-value="Moshi">
                                            <span class="flag">MS</span>
                                            Moshi
                                        </div>
                                        <div class="region-option" data-value="Tabora">
                                            <span class="flag">TB</span>
                                            Tabora
                                        </div>
                                        <div class="region-option" data-value="Singida">
                                            <span class="flag">SI</span>
                                            Singida
                                        </div>
                                        <div class="region-option" data-value="Shinyanga">
                                            <span class="flag">SH</span>
                                            Shinyanga
                                        </div>
                                        <div class="region-option" data-value="Iringa">
                                            <span class="flag">IR</span>
                                            Iringa
                                        </div>
                                        <div class="region-option" data-value="Songwe">
                                            <span class="flag">SO</span>
                                            Songwe
                                        </div>
                                        <div class="region-option" data-value="Kagera">
                                            <span class="flag">KG</span>
                                            Kagera
                                        </div>
                                        <div class="region-option" data-value="Mtwara">
                                            <span class="flag">MT</span>
                                            Mtwara
                                        </div>
                                        <div class="region-option" data-value="Lindi">
                                            <span class="flag">LI</span>
                                            Lindi
                                        </div>
                                        <div class="region-option" data-value="Ruvuma">
                                            <span class="flag">RV</span>
                                            Ruvuma
                                        </div>
                                        <div class="region-option" data-value="Kigoma">
                                            <span class="flag">KI</span>
                                            Kigoma
                                        </div>
                                        <div class="region-option" data-value="Pwani">
                                            <span class="flag">PW</span>
                                            Pwani (Coast)
                                        </div>
                                        <div class="region-option" data-value="Rukwa">
                                            <span class="flag">RK</span>
                                            Rukwa
                                        </div>
                                        <div class="region-option" data-value="Manyara">
                                            <span class="flag">MY</span>
                                            Manyara
                                        </div>
                                        <div class="region-option" data-value="Geita">
                                            <span class="flag">GT</span>
                                            Geita
                                        </div>
                                        <div class="region-option" data-value="Katavi">
                                            <span class="flag">KT</span>
                                            Katavi
                                        </div>
                                        <div class="region-option" data-value="Njombe">
                                            <span class="flag">NJ</span>
                                            Njombe
                                        </div>
                                        <div class="region-option" data-value="Simiyu">
                                            <span class="flag">SM</span>
                                            Simiyu
                                        </div>
                                    </div>
                                    
                                    <!-- Zanzibar Regions -->
                                    <div class="region-group">
                                        <div class="region-header">Zanzibar Regions</div>
                                        <div class="region-option" data-value="Zanzibar Urban">
                                            <span class="flag">ZU</span>
                                            Zanzibar Urban
                                        </div>
                                        <div class="region-option" data-value="Zanzibar West">
                                            <span class="flag">ZW</span>
                                            Zanzibar West
                                        </div>
                                        <div class="region-option" data-value="Zanzibar North">
                                            <span class="flag">ZN</span>
                                            Zanzibar North
                                        </div>
                                        <div class="region-option" data-value="Zanzibar South">
                                            <span class="flag">ZS</span>
                                            Zanzibar South
                                        </div>
                                        <div class="region-option" data-value="Pemba North">
                                            <span class="flag">PN</span>
                                            Pemba North
                                        </div>
                                        <div class="region-option" data-value="Pemba South">
                                            <span class="flag">PS</span>
                                            Pemba South
                                        </div>
                                    </div>
                                    
                                    <!-- Major Cities -->
                                    <div style="color: black;" class="region-group">
                                        <div class="region-header">Major Cities</div>
                                        <div class="region-option" data-value="Dar es Salaam City">
                                            <span class="flag">DC</span>
                                            Dar es Salaam City
                                        </div>
                                        <div class="region-option" data-value="Arusha City">
                                            <span class="flag">AC</span>
                                            Arusha City
                                        </div>
                                        <div class="region-option" data-value="Mwanza City">
                                            <span class="flag">MC</span>
                                            Mwanza City
                                        </div>
                                        <div class="region-option" data-value="Mbeya City">
                                            <span class="flag">MB</span>
                                            Mbeya City
                                        </div>
                                        <div class="region-option" data-value="Dodoma City">
                                            <span class="flag">DC</span>
                                            Dodoma City
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Property Type -->
                        <div class="col-lg-3">
                            <select class="form-select border-0 h-100" name="property_type" style="background: #f8f9fa;">
                                <option value="">Property Type</option>
                                <option value="house">House</option>
                                <option value="apartment">Apartment</option>
                                <option value="room">Room</option>
                                <option value="plot">Plot</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        
                        <!-- Bedrooms -->
                        <div class="col-lg-3">
                            <select class="form-select border-0 h-100" name="bedrooms" style="background: #f8f9fa;">
                                <option value="">Bedrooms</option>
                                <option value="1">1 Bedroom</option>
                                <option value="2">2 Bedrooms</option>
                                <option value="3">3 Bedrooms</option>
                                <option value="4">4+ Bedrooms</option>
                            </select>
                        </div>
                        
                        <!-- Search Button -->
                        <div class="col-lg-2">
                            <button type="submit" class="btn btn-lg btn-yellow w-100 h-100" style="border: none;">
                                <i class="bi bi-search me-2"></i>Search
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>


{% comment %}
<!-- Property Categories -->
<section class="py-5" style="background: #f8f9fa;">
    <div class="container">
        <h2 class="section-title fw-bold text-center mb-5">Property Categories</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="category-card text-center p-5">
                    <div class="feature-icon">
                        <i class="bi bi-house-door text-white fs-2"></i>
                    </div>
                    <h5 class="fw-bold mt-4 mb-3">Makazi</h5>
                    <p class="text-muted mb-4">Family homes, bungalows, and permanent residences</p>
                    <a href="{% url 'makazi:listings' %}?property_type=house" 
                       class="btn btn-primary" 
                       style="background: var(--blue-gradient); border: none;">
                        View Houses <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="category-card text-center p-5">
                    <div class="feature-icon">
                        <i class="bi bi-building text-white fs-2"></i>
                    </div>
                    <h5 class="fw-bold mt-4 mb-3">Apartments</h5>
                    <p class="text-muted mb-4">Flats and rental rooms in urban areas</p>
                    <a href="#" 
                       class="btn btn-primary" 
                       style="background: var(--blue-gradient); border: none;">
                        View Apartments <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="category-card text-center p-5">
                    <div class="feature-icon">
                        <i class="bi bi-map text-white fs-2"></i>
                    </div>
                    <h5 class="fw-bold mt-4 mb-3">Plots & Land</h5>
                    <p class="text-muted mb-4">Construction plots and farmlands</p>
                    <a href="#" 
                       class="btn btn-primary" 
                       style="background: var(--blue-gradient); border: none;">
                        View Plots <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endcomment %}
<!-- Latest Listings -->
<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h2 class="section-title fw-bold">Recently Added</h2>
                <p class="text-muted">Newly listed properties</p>
            </div>
            <a href="{% url 'makazi:listings' %}" class="btn btn-primary" style="background: var(--blue-gradient); border: none;">
                View All <i class="bi bi-arrow-right ms-2"></i>
            </a>
        </div>
        
        <div class="row">
            {% for listing in latest_listings %}
            <div class="col-lg-6 mb-4">
                <div class="property-card h-100">
                    <div class="row g-0 h-100">
                        <div class="col-md-5 position-relative">
                            <img src="{{ listing.main_image_url|default:'/static/images/default-property.jpg' }}" 
                                 class="img-fluid h-100" 
                                 style="object-fit: cover; min-height: 220px;"
                                 alt="{{ listing.title }}"
                                 onerror="this.src='/static/images/default-property.jpg'">
                            {% if listing.property_type == 'house' %}
                            <div class="property-badge">House</div>
                            {% elif listing.property_type == 'apartment' %}
                            <div class="property-badge">Apartment</div>
                            {% endif %}
                        </div>
                        <div class="col-md-7">
                            <div class="p-4 h-100 d-flex flex-column">
                                <div>
                                    <h6 class="fw-bold mb-2">{{ listing.title|truncatechars:50 }}</h6>
                                    <p class="text-blue mb-3">
                                        <i class="bi bi-geo-alt me-1"></i>{{ listing.location }}
                                    </p>
                                    <p class="small text-muted mb-4">
                                        {{ listing.description|truncatechars:120 }}
                                    </p>
                                </div>
                                
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <span class="text-yellow fw-bold fs-5">
                                            TSh {{ listing.price|floatformat:0 }}
                                        </span>
                                        {% if listing.bedrooms %}
                                        <span class="badge bg-blue text-white px-3 py-2">
                                            <i class="bi bi-door-closed me-1"></i>{{ listing.bedrooms }} Bedrooms
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            <i class="bi bi-clock me-1"></i>{{ listing.scraped_at|timesince }} ago
                                        </small>
                                        <a href="{{ listing.get_absolute_url }}" class="btn btn-yellow btn-sm">
                                            View <i class="bi bi-arrow-right ms-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Popular Locations -->
<section class="py-5" style="background: #f8f9fa;">
    <div class="container">
        <h2 class="section-title fw-bold text-center mb-5">Popular Locations</h2>
        <div class="row g-4">
            {% for location in popular_locations %}
            <div class="col-lg-3 col-md-4 col-6">
                <a href="{% url 'makazi:listings' %}?location={{ location.location }}" class="text-decoration-none">
                    <div class="location-card">
                        <img src="https://images.unsplash.com/photo-{{ forloop.counter|add:10 }}?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" 
                             alt="{{ location.location }}">
                        <div class="location-overlay">
                            <h6 class="fw-bold mb-1">{{ location.location }}</h6>
                            <small>{{ location.count }} Properties</small>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Call to Action -->
<section class="cta-section">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8 position-relative">
                <h2 class="fw-bold mb-4 display-5">Have a Property to Sell or Rent?</h2>
                <p style="color: white;" class="lead mb-5">Contact us today and list your property to reach thousands of potential buyers or tenants</p>
                <a href="#" class="btn btn-yellow btn-lg px-5 py-3 fw-bold" style="border-radius: 50px;">
                    <i class="bi bi-whatsapp me-2"></i>Upload Now
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const regionInput = document.getElementById('regionInput');
        const regionDropdown = document.getElementById('regionDropdown');
        const regionOptions = document.querySelectorAll('.region-option');
        
        // Toggle dropdown when clicking input
        regionInput.addEventListener('focus', function() {
            regionDropdown.classList.add('show');
        });
        
        regionInput.addEventListener('click', function(e) {
            e.stopPropagation();
            regionDropdown.classList.add('show');
        });
        
        // Handle option selection
        regionOptions.forEach(option => {
            option.addEventListener('click', function(e) {
                e.stopPropagation();
                const value = this.getAttribute('data-value');
                
                // Update input value
                regionInput.value = value;
                
                // Update selected state
                regionOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                // Close dropdown
                regionDropdown.classList.remove('show');
                
                // Add checkmark to selected option
                const checkmark = this.querySelector('.bi-check');
                if (!checkmark) {
                    const icon = document.createElement('i');
                    icon.className = 'bi bi-check ms-auto';
                    this.appendChild(icon);
                }
                
                // Remove checkmarks from other options
                regionOptions.forEach(opt => {
                    if (opt !== this) {
                        const check = opt.querySelector('.bi-check');
                        if (check) check.remove();
                    }
                });
            });
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!regionInput.contains(e.target) && !regionDropdown.contains(e.target)) {
                regionDropdown.classList.remove('show');
            }
        });
        
        // Add search functionality
        regionInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            if (searchTerm) {
                regionDropdown.classList.add('show');
                
                regionOptions.forEach(option => {
                    const text = option.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        option.style.display = 'flex';
                        option.parentElement.parentElement.style.display = 'block';
                    } else {
                        option.style.display = 'none';
                    }
                });
                
                // Show/hide region groups
                document.querySelectorAll('.region-group').forEach(group => {
                    const options = group.querySelectorAll('.region-option');
                    const visibleOptions = Array.from(options).filter(opt => 
                        opt.style.display !== 'none'
                    );
                    
                    if (visibleOptions.length > 0) {
                        group.style.display = 'block';
                    } else {
                        group.style.display = 'none';
                    }
                });
            } else {
                // Show all options if search is empty
                regionOptions.forEach(option => {
                    option.style.display = 'flex';
                });
                
                document.querySelectorAll('.region-group').forEach(group => {
                    group.style.display = 'block';
                });
            }
        });
        
        // Keyboard navigation
        regionInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                regionDropdown.classList.remove('show');
            }
        });
        
        // Property favorite functionality (same as before)
        const favoriteButtons = document.querySelectorAll('.favorite-btn');
        favoriteButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const listingId = this.dataset.listingId;
                const icon = this.querySelector('i');
                
                if (icon.classList.contains('bi-heart')) {
                    icon.className = 'bi bi-heart-fill text-yellow';
                    saveToFavorites(listingId);
                    showToast('Added to favorites');
                } else {
                    icon.className = 'bi bi-heart';
                    removeFromFavorites(listingId);
                    showToast('Removed from favorites');
                }
            });
        });
        
        // Check initial favorite status
        favoriteButtons.forEach(button => {
            const listingId = button.dataset.listingId;
            const favorites = JSON.parse(localStorage.getItem('nyumbafasta_favorites') || '[]');
            if (favorites.includes(listingId)) {
                button.querySelector('i').className = 'bi bi-heart-fill text-yellow';
            }
        });
        
        function saveToFavorites(listingId) {
            let favorites = JSON.parse(localStorage.getItem('nyumbafasta_favorites') || '[]');
            if (!favorites.includes(listingId)) {
                favorites.push(listingId);
                localStorage.setItem('nyumbafasta_favorites', JSON.stringify(favorites));
            }
        }
        
        function removeFromFavorites(listingId) {
            let favorites = JSON.parse(localStorage.getItem('nyumbafasta_favorites') || '[]');
            favorites = favorites.filter(id => id !== listingId);
            localStorage.setItem('nyumbafasta_favorites', JSON.stringify(favorites));
        }
        
        // Toast notification function
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast align-items-center text-white bg-blue border-0';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-check-circle-fill me-2 text-yellow"></i>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            // Add to container
            const container = document.createElement('div');
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            container.appendChild(toast);
            document.body.appendChild(container);
            
            // Initialize and show toast
            const bsToast = new bootstrap.Toast(toast, { delay: 3000 });
            bsToast.show();
            
            // Remove after hide
            toast.addEventListener('hidden.bs.toast', function () {
                container.remove();
            });
        }
    });
</script>
{% endblock %}