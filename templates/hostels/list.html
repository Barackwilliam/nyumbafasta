{% extends 'base.html' %}
{% load static %}

{% block title %}Student Hostels Tanzania - Affordable Accommodation for Universities | NyumbaFasta{% endblock %}

{% block content %}
<!-- Hero Section - Modern Design -->
<section class="hostel-hero py-5 position-relative overflow-hidden">
    <div class="container">
        <div class="row align-items-center min-vh-60">
            <div class="col-lg-6 text-white">
                <h1 class="display-5 fw-bold mb-4 animate__animated animate__fadeInUp">
                    Find Your <span class="text-warning">Perfect Student Home</span>
                </h1>
                <p class="lead mb-4 opacity-90 animate__animated animate__fadeInUp animate__delay-1s">
                    Safe, affordable, and comfortable hostels near universities, colleges, and VETA institutes across Tanzania. 
                    Book your ideal accommodation for the academic year.
                </p>
             
            </div>
            <div class="col-lg-6">
                <div class="position-relative">
                    <div class="floating-element floating-1">
                        <div class="card border-0 shadow-lg">
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary bg-opacity-10 p-3 rounded-circle me-3">
                                        <i class="bi bi-shield-check text-primary fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">Verified hostels</h6>
                                        <small class="text-muted">100% safety guaranteed</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="floating-element floating-2">
                        <div class="card border-0 shadow-lg">
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-warning bg-opacity-10 p-3 rounded-circle me-3">
                                        <i class="bi bi-cash-coin text-warning fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1 fw-bold">Affordable Prices</h6>
                                        <small class="text-muted">Student-friendly rates</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Wave Shape -->
    <div class="wave-shape">
        <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 60L60 55C120 50 240 40 360 35C480 30 600 30 720 35C840 40 960 50 1080 55C1200 60 1320 60 1380 60H1440V120H0V60Z" fill="white"/>
        </svg>
    </div>
</section>

<!-- Search Section -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                    <div class="card-body p-4 p-lg-5">
                        <div class="text-center mb-4">
                            <h2 class="h3 fw-bold mb-3">Find Your Ideal Hostel</h2>
                            <p class="text-muted mb-0">Search by university, location, or hostel type</p>
                        </div>
                        
                        <form method="get" class="row g-3">
                            <div class="col-lg-4">
                                <label class="form-label fw-semibold">University/College</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-mortarboard text-primary"></i>
                                    </span>
                                    <input type="text" name="university" class="form-control border-start-0 ps-0" 
                                           placeholder="e.g., UDSM, DIT, MUCE" value="{{ request.GET.university }}">
                                </div>
                            </div>
                            
                            <div class="col-lg-3">
                                <label class="form-label fw-semibold">Hostel Type</label>
                                <select name="hostel_type" class="form-select">
                                    <option value="">All Types</option>
                                    <option value="university" {% if request.GET.hostel_type == 'university' %}selected{% endif %}>
                                        University Hostel
                                    </option>
                                    <option value="private" {% if request.GET.hostel_type == 'private' %}selected{% endif %}>
                                        Private Hostel
                                    </option>
                                    <option value="college" {% if request.GET.hostel_type == 'college' %}selected{% endif %}>
                                        College Hostel
                                    </option>
                                    <option value="veta" {% if request.GET.hostel_type == 'veta' %}selected{% endif %}>
                                        VETA Hostel
                                    </option>
                                </select>
                            </div>
                            
                            <div class="col-lg-3">
                                <label class="form-label fw-semibold">Gender</label>
                                <select name="gender_allowed" class="form-select">
                                    <option value="">All Genders</option>
                                    <option value="male" {% if request.GET.gender_allowed == 'male' %}selected{% endif %}>
                                        Male Only
                                    </option>
                                    <option value="female" {% if request.GET.gender_allowed == 'female' %}selected{% endif %}>
                                        Female Only
                                    </option>
                                    <option value="mixed" {% if request.GET.gender_allowed == 'mixed' %}selected{% endif %}>
                                        Mixed
                                    </option>
                                </select>
                            </div>
                            
                            <div class="col-lg-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100 py-3 fw-bold">
                                    <i class="bi bi-search me-2"></i>Search
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- Hostels Grid -->
<section id="hostels-grid" class="py-5 bg-light">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md-8">
                <h2 class="fw-bold mb-3">Available Hostels</h2>
                <p class="text-muted mb-0">Find accommodation that fits your needs and budget</p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="dropdown">
                    <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        Sort by: {% if request.GET.sort == 'price_per_semester' %}Price: Low to High{% elif request.GET.sort == '-price_per_semester' %}Price: High to Low{% else %}Newest{% endif %}
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="?sort=-created_at">Newest First</a></li>
                        <li><a class="dropdown-item" href="?sort=price_per_semester">Price: Low to High</a></li>
                        <li><a class="dropdown-item" href="?sort=-price_per_semester">Price: High to Low</a></li>
                        <li><a class="dropdown-item" href="?sort=-available_rooms">Most Available</a></li>
                    </ul>
                </div>
            </div>
        </div>

        {% if hostels %}
        <div class="row g-4">
            {% for hostel in hostels %}
            <div class="col-xl-4 col-lg-6">
                <div class="card hostel-card border-0 h-100 overflow-hidden position-relative">
                    <!-- Image with Overlay -->
                    <div class="hostel-image position-relative overflow-hidden" style="height: 220px;">
                        {% if hostel.main_image %}
                        <img src="{{ hostel.main_image.url }}" class="img-fluid w-100 h-100 object-cover" 
                             alt="{{ hostel.name }}" loading="lazy">
                        {% else %}
                        <div class="w-100 h-100 bg-gradient-primary d-flex align-items-center justify-content-center">
                            <div class="text-center text-white p-4">
                                <i class="bi bi-building fs-1"></i>
                                <p class="mt-2 fw-semibold">Hostel Image</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Overlay Gradient -->
                        <div class="image-overlay"></div>
                        
                        <!-- Price Badge -->
                        <div class="position-absolute top-3 end-3">
                            <span class="badge bg-white text-dark fw-bold px-3 py-2 shadow">
                                TSh {{ hostel.price_per_semester|floatformat:0 }}
                            </span>
                        </div>
                        
                        <!-- Type Badge -->
                        <div class="position-absolute top-3 start-3">
                            <span class="badge bg-warning text-dark px-3 py-2">
                                {{ hostel.get_hostel_type_display }}
                            </span>
                        </div>
                    </div>

                    <!-- Card Body -->
                    <div class="card-body p-4">
                        <!-- University -->
                        <div class="mb-3">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="bi bi-mortarboard text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="fw-bold mb-0">{{ hostel.university|truncatechars:30 }}</h6>
                                    <small class="text-muted">
                                        <i class="bi bi-geo-alt"></i> {{ hostel.location }}
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Hostel Name -->
                        <h5 class="fw-bold mb-3">{{ hostel.name }}</h5>

                        <!-- Quick Info -->
                        <div class="row g-2 mb-4">
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-people text-primary me-2"></i>
                                    <small>{{ hostel.total_capacity }} capacity</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-door-closed text-primary me-2"></i>
                                    <small>{{ hostel.available_rooms }} available</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-gender-ambiguous text-primary me-2"></i>
                                    <small>{{ hostel.get_gender_allowed_display }}</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-calendar-check text-primary me-2"></i>
                                    <small>{{ hostel.academic_year }}</small>
                                </div>
                            </div>
                        </div>

                        <!-- Amenities -->
                        {% if hostel.amenities %}
                        <div class="mb-4">
                            <small class="text-muted d-block mb-2">Amenities</small>
                            <div class="d-flex flex-wrap gap-2">
                                {% for amenity in hostel.amenities|slice:":3" %}
                                <span class="badge bg-light text-dark border">
                                    {% if amenity == 'wifi' %}<i class="bi bi-wifi me-1"></i>WiFi
                                    {% elif amenity == 'security' %}<i class="bi bi-shield-check me-1"></i>Security
                                    {% elif amenity == 'library' %}<i class="bi bi-book me-1"></i>Library
                                    {% elif amenity == 'laundry' %}<i class="bi bi-bucket me-1"></i>Laundry
                                    {% elif amenity == 'parking' %}<i class="bi bi-p-square me-1"></i>Parking
                                    {% endif %}
                                </span>
                                {% endfor %}
                                {% if hostel.amenities|length > 3 %}
                                <span class="badge bg-light text-dark border">
                                    +{{ hostel.amenities|length|add:"-3" }} more
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Action Button -->
                        <a href="{% url 'makazi:hostel_detail' hostel.pk %}" 
                           class="btn btn-primary w-100 py-3 fw-bold">
                            <i class="bi bi-eye me-2"></i>View Details & Book
                        </a>
                    </div>

                    <!-- Verified Badge -->
                    {% if hostel.is_verified %}
                    <div class="position-absolute bottom-0 end-0 m-3">
                        <span class="badge bg-success px-3 py-2">
                            <i class="bi bi-check-circle me-1"></i>Verified
                        </span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- PAGINATION FIXED - COPY THIS SECTION -->
        {% if hostels.has_other_pages %}
        <nav class="mt-5">
            <ul class="pagination justify-content-center">
                {% if hostels.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ hostels.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        <i class="bi bi-chevron-left"></i> Previous
                    </a>
                </li>
                {% endif %}

                {% for num in hostels.paginator.page_range %}
                    {% if num > hostels.number|add:'-3' and num < hostels.number|add:'3' %}
                    <li class="page-item {% if hostels.number == num %}active{% endif %}">
                        <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            {{ num }}
                        </a>
                    </li>
                    {% endif %}
                {% endfor %}

                {% if hostels.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ hostels.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                        Next <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <!-- Empty State -->
        <div class="text-center py-5">
            <div class="empty-state-icon mb-4">
                <i class="bi bi-building-slash display-1 text-muted"></i>
            </div>
            <h3 class="fw-bold mb-3">No hostels found</h3>
            <p class="text-muted mb-4">Try adjusting your search criteria or browse popular universities below</p>
            <a href="{% url 'makazi:hostels_list' %}" class="btn btn-primary">
                <i class="bi bi-arrow-clockwise me-2"></i>Reset Filters
            </a>
        </div>
        {% endif %}
    </div>
</section>

<!-- Popular Universities -->
{% if popular_universities %}
<section id="popular-universities" class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-3">Browse by University</h2>
            <p class="text-muted">Find hostels near your institution</p>
        </div>
        
        <div class="row g-4">
            {% for uni in popular_universities %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <a href="{% url 'makazi:hostels_list' %}?university={{ uni.university|urlencode }}" 
                   class="university-card text-decoration-none">
                    <div class="card border-0 shadow-sm h-100 hover-lift">
                        <div class="card-body text-center p-4">
                            <div class="university-icon mb-3">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                                     style="width: 70px; height: 70px;">
                                    <i class="bi bi-mortarboard fs-3 text-primary"></i>
                                </div>
                            </div>
                            <h6 class="fw-bold mb-2">{{ uni.university|truncatechars:25 }}</h6>
                            <div class="badge bg-primary bg-opacity-10 text-primary px-3 py-1">
                                {{ uni.count }} hostels
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Why Choose Us -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-3">Why Choose Our Hostels</h2>
            <p class="text-muted">We ensure the best student living experience</p>
        </div>
        
        <div class="row g-4">
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon mb-4">
                        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 80px; height: 80px;">
                            <i class="bi bi-shield-check fs-2 text-primary"></i>
                        </div>
                    </div>
                    <h5 class="fw-bold mb-3">Verified Properties</h5>
                    <p class="text-muted">All hostels are inspected and verified for safety and quality standards.</p>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon mb-4">
                        <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 80px; height: 80px;">
                            <i class="bi bi-cash-coin fs-2 text-warning"></i>
                        </div>
                    </div>
                    <h5 class="fw-bold mb-3">Affordable Rates</h5>
                    <p class="text-muted">Student-friendly pricing with flexible payment options and discounts.</p>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon mb-4">
                        <div class="bg-success bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 80px; height: 80px;">
                            <i class="bi bi-headset fs-2 text-success"></i>
                        </div>
                    </div>
                    <h5 class="fw-bold mb-3">24/7 Support</h5>
                    <p class="text-muted">Round-the-clock assistance for students and hostel management.</p>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="text-center p-4">
                    <div class="feature-icon mb-4">
                        <div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center" 
                             style="width: 80px; height: 80px;">
                            <i class="bi bi-calendar-check fs-2 text-info"></i>
                        </div>
                    </div>
                    <h5 class="fw-bold mb-3">Easy Booking</h5>
                    <p class="text-muted">Simple online booking process with instant confirmation.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="fw-bold mb-3">Ready to Find Your Student Home?</h3>
                <p class="mb-0 opacity-90">Join thousands of students who found their perfect accommodation through NyumbaFasta.</p>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'makazi:hostels_list' %}" class="btn btn-warning btn-lg px-5 py-3 fw-bold">
                    Browse All Hostels <i class="bi bi-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    /* Modern Hero Section */
    .hostel-hero {
        background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
        position: relative;
        overflow: hidden;
    }

    .min-vh-60 {
        min-height: 60vh;
    }

    /* Floating Elements Animation */
    .floating-element {
        position: absolute;
        animation: float 6s ease-in-out infinite;
    }

    .floating-1 {
        top: -20px;
        right: 50px;
        animation-delay: 0s;
    }

    .floating-2 {
        bottom: 30px;
        right: 100px;
        animation-delay: 2s;
    }

    @keyframes float {
        0%, 100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-20px);
        }
    }

    /* Wave Shape */
    .wave-shape {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        line-height: 0;
    }

    /* Hostel Cards */
    .hostel-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 16px;
        overflow: hidden;
    }

    .hostel-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
    }

    .hostel-image {
        border-radius: 16px 16px 0 0;
        overflow: hidden;
    }

    .hostel-image img {
        transition: transform 0.6s ease;
    }

    .hostel-card:hover .hostel-image img {
        transform: scale(1.05);
    }

    .image-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.1));
    }

    /* University Cards */
    .university-card .card {
        transition: all 0.3s ease;
        border: 1px solid #e9ecef;
    }

    .university-card:hover .card {
        border-color: #4361ee;
        box-shadow: 0 10px 20px rgba(67, 97, 238, 0.1);
    }

    .hover-lift:hover {
        transform: translateY(-5px);
    }

    /* Responsive Typography */
    @media (max-width: 768px) {
        .display-5 {
            font-size: 2.5rem;
        }
        
        .lead {
            font-size: 1.1rem;
        }
        
        .hostel-card {
            margin-bottom: 1.5rem;
        }
    }

    /* Smooth Animations */
    .animate__animated {
        --animate-duration: 1s;
    }

    /* Custom Colors */
    .bg-gradient-primary {
        background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
    }

    .object-cover {
        object-fit: cover;
    }

    /* Empty State */
    .empty-state-icon {
        opacity: 0.5;
    }

    /* Button Hover Effects */
    .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 214, 10, 0.3);
    }

    /* Custom Badge Styles */
    .badge.bg-white {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Form Styles */
    .form-select, .form-control {
        border-radius: 10px;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
    }

    .form-select:focus, .form-control:focus {
        border-color: #4361ee;
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    /* Feature Icons */
    .feature-icon {
        transition: transform 0.3s ease;
    }

    .feature-icon:hover {
        transform: scale(1.1);
    }

    /* Page Transitions */
    .fade-in {
        animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add fade-in animation to elements
        const animateElements = document.querySelectorAll('.hostel-card, .feature-icon, .university-card');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        
        animateElements.forEach(el => observer.observe(el));
        
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href !== '#') {
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }
            });
        });
        
        // Update stats counter animation
        const stats = document.querySelectorAll('.display-6');
        stats.forEach(stat => {
            const target = parseInt(stat.textContent);
            let current = 0;
            const increment = target / 50;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                stat.textContent = Math.floor(current) + (target > 1000 ? '+' : '');
            }, 20);
        });
        
        // Add hover effect to cards
        document.querySelectorAll('.hostel-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-8px)';
            });
            
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0)';
            });
        });
        
        // Form validation
        const searchForm = document.querySelector('form[method="get"]');
        if (searchForm) {
            searchForm.addEventListener('submit', function(e) {
                const universityInput = this.querySelector('input[name="university"]');
                if (universityInput && universityInput.value.trim().length < 2) {
                    // Optional: Show warning but don't prevent submission
                    universityInput.style.borderColor = '#ffc107';
                    setTimeout(() => {
                        universityInput.style.borderColor = '#e9ecef';
                    }, 2000);
                }
            });
        }
    });
</script>
{% endblock %}